<div class="flex justify-between items-center mb-4 pb-2 border-b-2 border-orange-200">
    <h2 class="text-lg font-semibold text-orange-800">Konten</h2>
    <button
        (click)="toggleForm()"
        class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1.5 rounded-lg text-sm font-medium transition-colors"
        title="Neues Konto erstellen"
    >
        +
    </button>
</div>

<!-- Modal for creating new repo -->
<app-modal [isOpen]="showForm()" [title]="'Neues Konto erstellen'" (close)="toggleForm()">
    <form [formGroup]="repoForm" (ngSubmit)="onSubmitRepo()">
        <!-- Repository Name -->
        <div class="mb-4">
            <label for="repoName" class="block text-sm font-medium text-gray-700 mb-2">
                Name *
            </label>
            <input
                type="text"
                id="repoName"
                formControlName="repoName"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                [class.border-red-500]="repoForm.get('repoName')?.invalid && repoForm.get('repoName')?.touched"
                placeholder="z.B. Girokonto, Sparkonto..."
            />
            @if (repoForm.get('repoName')?.invalid && repoForm.get('repoName')?.touched) {
                <p class="text-red-500 text-xs mt-1">Name ist erforderlich (min. 2 Zeichen)</p>
            }
        </div>

        <!-- Description -->
        <div class="mb-4">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                Beschreibung
            </label>
            <textarea
                id="description"
                formControlName="description"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                placeholder="Optionale Beschreibung..."
            ></textarea>
        </div>

        <!-- Currency and Start Balance -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
                <label for="currency" class="block text-sm font-medium text-gray-700 mb-2">
                    WÃ¤hrung *
                </label>
                <select
                    id="currency"
                    formControlName="currency"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                >
                    @for (curr of commonCurrencies; track curr.code) {
                        <option [value]="curr.code">{{ curr.name }}</option>
                    }
                </select>
            </div>

            <div>
                <label for="startBalance" class="block text-sm font-medium text-gray-700 mb-2">
                    Startguthaben *
                </label>
                <input
                    type="number"
                    id="startBalance"
                    formControlName="startBalance"
                    step="0.01"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                    [class.border-red-500]="repoForm.get('startBalance')?.invalid && repoForm.get('startBalance')?.touched"
                />
            </div>
        </div>

        <!-- Start Balance Date -->
        <div class="mb-6">
            <label for="startBalanceDate" class="block text-sm font-medium text-gray-700 mb-2">
                Datum des Startguthabens *
            </label>
            <input
                type="date"
                id="startBalanceDate"
                formControlName="startBalanceDate"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                [class.border-red-500]="repoForm.get('startBalanceDate')?.invalid && repoForm.get('startBalanceDate')?.touched"
            />
        </div>

        <!-- Submit Buttons -->
        <div class="flex justify-end gap-3">
            <button
                type="button"
                (click)="toggleForm()"
                class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                [disabled]="isSubmitting()"
            >
                Abbruch
            </button>
            <button
                type="submit"
                class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                [disabled]="isSubmitting()"
            >
                {{ isSubmitting() ? 'Erstelle...' : 'Erstellen' }}
            </button>
        </div>
    </form>
</app-modal>

<nav class="flex flex-col gap-2">
    <!-- option for all repos combined -->
    <button
        (click)="selectRepo('Alle')"
        [class]="selRepo() === 'Alle'
            ? 'bg-orange-100 text-orange-900 border-l-4 border-l-orange-400 px-4 py-2.5 border-y border-r border-gray-200 cursor-pointer transition-all text-left font-medium'
            : 'text-gray-700 border-l-4 border-l-transparent hover:border-l-orange-200 hover:bg-gray-50 px-4 py-2.5 border-y border-r border-transparent cursor-pointer transition-all text-left font-medium'"
    >
        Alle
    </button>

    <!-- Individual repo buttons -->
    @for (repo of allRepos(); track repo.id) {
    <button
        (click)="selectRepo(repo.repoName)"
        [class]="selRepo() === repo.repoName
            ? 'bg-orange-100 text-orange-900 border-l-4 border-l-orange-400 px-4 py-2.5 border-y border-r border-gray-200 cursor-pointer transition-all text-left font-medium'
            : 'text-gray-700 border-l-4 border-l-transparent hover:border-l-orange-200 hover:bg-gray-50 px-4 py-2.5 border-y border-r border-transparent cursor-pointer transition-all text-left font-medium'"
    >
        {{ repo.repoName }}
    </button>
    }
</nav>