<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Umsätze</h2>
    <div class="flex items-center gap-4">
        <p class="text-gray-600">{{ transfers().length }} Umsätze</p>
        <button
            (click)="toggleForm()"
            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 shadow-sm hover:shadow-md"
        >
            @if (!showForm()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            }
            <span>{{ showForm() ? 'Abbruch' : 'Neuer Umsatz' }}</span>
        </button>
    </div>
</div>

@if (showForm()) {
<div class="bg-white p-6 rounded-lg shadow-md mb-6">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Neuer Umsatz</h3>

    <form [formGroup]="transferForm" (ngSubmit)="onPostSubmitTransfer()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <!-- Repository Selection -->
            <div>
                <label for="repoId" class="block text-sm font-medium text-gray-700 mb-2">
                    Konto/Verwahrstelle *
                </label>
                <select
                    id="repoId"
                    formControlName="repoId"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    [class.border-red-500]="transferForm.get('repoId')?.invalid && transferForm.get('repoId')?.touched"
                >
                    <option [value]="null">Bitte wählen ...</option>
                    @for (repo of userRepos(); track repo.id) {
                        <option [value]="repo.id">{{ repo.repoName }}</option>
                    }
                </select>
                @if (transferForm.get('repoId')?.invalid && transferForm.get('repoId')?.touched) {
                    <p class="text-red-500 text-xs mt-1">Es muss ein Konto gewählt sein</p>
                }
            </div>

            <!-- Transfer Type -->
            <div>
                <label for="transferType" class="block text-sm font-medium text-gray-700 mb-2">
                    Umsatz-Typ *
                </label>
                <select
                    id="transferType"
                    formControlName="transferType"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                    <option value="income">Einkommen</option>
                    <option value="expense">Ausgabe</option>
                </select>
            </div>

            <!-- Transfer Value -->
            <div>
                <label for="transferValue" class="block text-sm font-medium text-gray-700 mb-2">
                    Betrag (€) *
                </label>
                <input
                    type="number"
                    id="transferValue"
                    formControlName="transferValue"
                    step="0.01"
                    min="0.01"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    [class.border-red-500]="transferForm.get('transferValue')?.invalid && transferForm.get('transferValue')?.touched"
                />
                @if (transferForm.get('transferValue')?.invalid && transferForm.get('transferValue')?.touched) {
                    <p class="text-red-500 text-xs mt-1">Betrag muss min. 0.01 sein</p>
                }
            </div>

            <!-- Transfer Date -->
            <div>
                <label for="transferDate" class="block text-sm font-medium text-gray-700 mb-2">
                    Datum und Uhrzeit *
                </label>
                <input
                    type="datetime-local"
                    id="transferDate"
                    formControlName="transferDate"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    [class.border-red-500]="transferForm.get('transferDate')?.invalid && transferForm.get('transferDate')?.touched"
                />
            </div>
        </div>

        <!-- Description -->
        <div class="mb-4">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                Beschreibung (empfohlen)
            </label>
            <textarea
                id="description"
                formControlName="description"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                [class.border-red-500]="transferForm.get('description')?.invalid && transferForm.get('description')?.touched"
                placeholder="Beschreibung ..."
            ></textarea>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end gap-3">
            <button
                type="button"
                (click)="toggleForm()"
                class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                [disabled]="isSubmitting()"
            >
                Abbruch
            </button>
            <button
                type="submit"
                class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                [disabled]="isSubmitting()"
            >
                {{ isSubmitting() ? 'Speichert...' : 'Erstellen' }}
            </button>
        </div>
    </form>
</div>
}

<div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-5">
    @for (transfer of transfers(); track transfer.id) {
    <div class="bg-white p-5 rounded-lg shadow-md hover:shadow-xl transition-shadow">
        <div class="flex justify-between items-center mb-3">
        <span class="text-sm text-gray-500 font-medium">{{ transfer.transferDate | date: "dd.MM.y HH:mm" : "UTC"}}</span>
        <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">
            Kategorie
        </span>
        </div>
        <div class="text-lg font-semibold text-gray-900 mb-3">{{ transfer.description }}</div>
        <div class="flex justify-between items-center">
        <span class="text-sm text-gray-500">{{ transfer.repoName }}</span>
        <span
            [class.text-green-600]="transfer.transferType === 'income'"
            [class.text-red-600]="transfer.transferType === 'expense'"
            class="text-xl font-bold"
        >
            {{ transfer.transferValue | number:'1.2-2' }} €
        </span>
        </div>
    </div>
    }
</div>

@if (transfers().length === 0) {
    <div class="text-center py-12 bg-white rounded-lg shadow-md">
    <p class="text-lg text-gray-500">
        No transfers found for {{ selRepo() === 'Alle' ? 'any repository' : selRepo() }}.
    </p>
    </div>
}